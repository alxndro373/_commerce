{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  
  <!-- Header -->
  <div class="text-center mb-4">
    <h2 class="text-dark mb-2">
      <i class="bi bi-receipt text-primary me-2"></i>Detalle del Pedido
    </h2>
    <p class="text-muted">Información completa de tu pedido #{{ pedido.id }}</p>
  </div>

  <div class="row">
    <!-- Información principal -->
    <div class="col-lg-8 mb-4">
      
      <!-- Información del pedido -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-info-circle me-2"></i>Información del Pedido
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-calendar3 text-primary me-3 fs-5"></i>
                <div>
                  <strong>Fecha del Pedido</strong>
                  <br><span class="text-muted">{{ pedido.fecha.strftime('%d/%m/%Y %H:%M') if pedido.fecha else 'No disponible' }}</span>
                </div>
              </div>
              
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-tag text-primary me-3 fs-5"></i>
                <div>
                  <strong>Estado del Pedido</strong>
                  <br>
                  {% if pedido.estado == 'pendiente' %}
                    <span class="badge bg-warning fs-6">
                      <i class="bi bi-clock me-1"></i>{{ pedido.estado|title }}
                    </span>
                  {% elif pedido.estado == 'enviado' %}
                    <span class="badge bg-info fs-6">
                      <i class="bi bi-truck me-1"></i>{{ pedido.estado|title }}
                    </span>
                  {% elif pedido.estado == 'entregado' %}
                    <span class="badge bg-success fs-6">
                      <i class="bi bi-check-circle me-1"></i>{{ pedido.estado|title }}
                    </span>
                  {% elif pedido.estado == 'cancelado' %}
                    <span class="badge bg-danger fs-6">
                      <i class="bi bi-x-circle me-1"></i>{{ pedido.estado|title }}
                    </span>
                  {% else %}
                    <span class="badge bg-secondary fs-6">{{ pedido.estado|title }}</span>
                  {% endif %}
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-hash text-primary me-3 fs-5"></i>
                <div>
                  <strong>ID del Pedido</strong>
                  <br><span class="text-muted">{{ pedido.id }}</span>
                </div>
              </div>
              
              <div class="d-flex align-items-center mb-3">
                <i class="bi bi-currency-dollar text-success me-3 fs-5"></i>
                <div>
                  <strong>Total del Pedido</strong>
                  <br><span class="fw-bold text-success fs-5">${{ "%.2f"|format(pedido.total) }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Productos del pedido -->
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white">
          <h5 class="mb-0">
            <i class="bi bi-bag me-2"></i>Productos Pedidos
          </h5>
        </div>
        <div class="card-body">
          {% if pedido.productos %}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th><i class="bi bi-box me-2"></i>Producto</th>
                    <th class="text-end"><i class="bi bi-currency-dollar me-2"></i>Precio Unit.</th>
                    <th class="text-center"><i class="bi bi-hash me-2"></i>Cantidad</th>
                    <th class="text-end"><i class="bi bi-calculator me-2"></i>Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  {% for producto in pedido.productos %}
                  <tr>
                    <td>
                      <div class="fw-bold">{{ producto.nombre }}</div>
                      <small class="text-muted">Producto del pedido</small>
                    </td>
                    <td class="text-end">
                      <span class="text-success">${{ "%.2f"|format(producto.precio) }}</span>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-secondary">{{ producto.cantidad }}</span>
                    </td>
                    <td class="text-end">
                      <span class="fw-bold text-primary">${{ "%.2f"|format(producto.subtotal) }}</span>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr class="table-success">
                    <th colspan="3" class="text-end">
                      <i class="bi bi-receipt me-2"></i>Total del Pedido:
                    </th>
                    <th class="text-end fs-5">
                      ${{ "%.2f"|format(pedido.total) }}
                    </th>
                  </tr>
                </tfoot>
              </table>
            </div>
          {% else %}
            <div class="text-center py-4">
              <i class="bi bi-inbox text-muted" style="font-size: 3rem;"></i>
              <p class="text-muted mt-3">No hay productos en este pedido</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
      
      <!-- Acciones rápidas -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0">
            <i class="bi bi-gear me-2"></i>Acciones Rápidas
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{{ url_for('ver_pedidos') }}" class="btn btn-outline-primary">
              <i class="bi bi-arrow-left me-2"></i>Volver a Mis Pedidos
            </a>
            <a href="{{ url_for('listar_productos') }}" class="btn btn-primary">
              <i class="bi bi-shop me-2"></i>Seguir Comprando
            </a>
            <button class="btn btn-outline-info" onclick="window.print()">
              <i class="bi bi-printer me-2"></i>Imprimir Pedido
            </button>
          </div>
        </div>
      </div>

      <!-- Estado del pedido -->
      <div class="card shadow-sm">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">
            <i class="bi bi-truck me-2"></i>Estado del Envío
          </h5>
        </div>
        <div class="card-body">
          {% if pedido.estado == 'pendiente' %}
            <div class="alert alert-warning mb-0">
              <div class="d-flex align-items-center">
                <i class="bi bi-clock-history fs-4 me-3"></i>
                <div>
                  <strong>Pedido Pendiente</strong>
                  <p class="mb-0 small">Tu pedido está siendo procesado. Te notificaremos cuando esté listo para envío.</p>
                </div>
              </div>
            </div>
          {% elif pedido.estado == 'enviado' %}
            <div class="alert alert-info mb-0">
              <div class="d-flex align-items-center">
                <i class="bi bi-truck fs-4 me-3"></i>
                <div>
                  <strong>Pedido Enviado</strong>
                  <p class="mb-0 small">Tu pedido está en camino. Recibirás información de seguimiento pronto.</p>
                </div>
              </div>
            </div>
          {% elif pedido.estado == 'entregado' %}
            <div class="alert alert-success mb-0">
              <div class="d-flex align-items-center">
                <i class="bi bi-check-circle-fill fs-4 me-3"></i>
                <div>
                  <strong>Pedido Entregado</strong>
                  <p class="mb-0 small">¡Tu pedido ha sido entregado exitosamente! Esperamos que disfrutes tu compra.</p>
                </div>
              </div>
            </div>
          {% elif pedido.estado == 'cancelado' %}
            <div class="alert alert-danger mb-0">
              <div class="d-flex align-items-center">
                <i class="bi bi-x-circle-fill fs-4 me-3"></i>
                <div>
                  <strong>Pedido Cancelado</strong>
                  <p class="mb-0 small">Este pedido ha sido cancelado. Si tienes dudas, contacta con soporte.</p>
                </div>
              </div>
            </div>
          {% else %}
            <div class="alert alert-secondary mb-0">
              <div class="d-flex align-items-center">
                <i class="bi bi-info-circle fs-4 me-3"></i>
                <div>
                  <strong>Estado: {{ pedido.estado|title }}</strong>
                  <p class="mb-0 small">Estado actual del pedido.</p>
                </div>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}